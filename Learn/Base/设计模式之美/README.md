# 设计模式之美 #

开篇词

## 开篇词 | 一对一的设计与编码集训，让你告别没有成长的烂代码 ##

如果说“数据结构与算法之美”是教你写出高效的代码，那这个设计模式专栏就是教你写出高质量的代码。

### 程序员的看家本领你得练好 ###

当你把写高质量代码培养成一种开发习惯之后，在你在编写代码的时候，自然就有一种代码质量意识，自然而然就可以写出不错的代码。

### 一个人闷头看书效果并不好 ###

一些比较上进的工程师，会去找设计模式、编码规范、重构等类型的书籍去看，学习如何编写高质量的代码。

* 比较偏重理论讲解
* 一个人自己闷头看书，在很多时候效果并不好
	* 跟着有经验的老师学比闷头自己看书要更高效、收获更多、成长更快 
	* 编码本身就是一门实践课，光闷头看书本理论肯定是不够的，更重要的是在实践中学习如何应用这些理论

KISS原则（Keep it Simple and Stupid）

### 一对一手把手指导才最有效 ###

从我的经验来看，我觉得最有效、最快速提高编码能力的方法就是，找一个比你资深的工程师，一对一、手把手地指导你写代码。你提交代码，他来指出你的问题，你再优化，这样一来一往，要不了多久，你就会发现，自己的代码能力突飞猛进。

### 我是如何设计这个专栏的？ ###

我想一次性把跟编写高质量代码相关的所有知识，都系统、全面地讲清楚，一次性给你讲透彻。你看完我这一个专栏，就能搞清楚所有跟写高质量代码相关的知识点。

#### 200 多个真实的项目实战代码案例剖析 ####

大部分设计原则、设计思想、设计模式理解起来都不难，难的是如何将这些理论灵活恰当地应用到实际的开发中，而不是教条主义和盲目滥用。

#### 8 个月、240 天一对一手把手编程指导 ####

最有效的手段就是让有经验的前辈一对一、手把手地指导。我经历过 Google 最严格的 Code Review。

#### 100 多个有深度的课堂讨论、头脑风暴 ####

不要轻信一家之言，更不要迷信我的专栏，也不要盲目追从任何一位专家、大师的说法。主动思考，积极讨论，比单纯地被动接受，学习效果要好十倍、百倍。

### 让我们一起见证成长 ###

# 设计模式学习导读 #

## 01 | 为什么说每个程序员都要尽早地学习并掌握设计模式相关知识？ ##

设计模式和操作系统、组成原理、编译原理等这些基础学科是不一样的。它虽然也算是一门基础知识，但是它和数据结构、算法更像是一道儿的，相比那些更加基础的学科，设计模式能更直接地提高你的开发能力。

如果说数据结构和算法是教你如何写出高效代码，那设计模式讲的是如何写出可扩展、可读、可维护的高质量代码。

### 1. 应对面试中的设计模式相关问题 ###

学习设计模式和算法一样，最功利、最直接的目的，可能就是应对面试了。

### 2. 告别写被人吐槽的烂代码 ###

我会通过实战例子，手把手教你如何避免刚刚提到的代码问题，告别被人诟病的烂代码，写出令人称道的好代码，成为团队中的代码标杆。

### 3. 提高复杂代码的设计和开发能力 ###

而我当时并没有对设计模式相关的知识（包括设计模式、设计原则、面向对象设计思想等）有太多的了解和积累，所以一时间搞得我手足无措。好在因此我意识到了这方面知识的重要性，所以在之后很多年的开发中，我都一直刻意锻炼、积累这方面的能力。面对复杂代码、功能、系统的设计和开发，我也越来越得心应手，游刃有余。

### 4. 让读源码、学框架事半功倍 ###

优秀的开源项目、框架、中间件，代码量、类的个数都会比较多，类结构、类之间的关系极其复杂，常常调用来调用去。所以，为了保证代码的扩展性、灵活性、可维护性等，代码中会使用到很多设计模式、设计原则或者设计思想。如果你不懂这些设计模式、原则、思想，在看代码的时候，你可能就会琢磨不透作者的设计思路，对于一些很明显的设计思路，你可能要花费很多时间才能参悟。相反，如果你对设计模式、原则、思想非常了解，一眼就能参透作者的设计思路、设计初衷，很快就可以把脑容量释放出来，重点思考其他问题，代码读起来就会变得轻松了。

### 5. 为你的职场发展做铺垫 ###

### 重点回顾 ###

* 应对面试中的设计模式相关问题；
* 告别写被人吐槽的烂代码；
* 提高复杂代码的设计和开发能力；
* 让读源码、学框架事半功倍；
* 为你的职场发展做铺垫。

设计模式作为一门与编码、开发有着直接关系的基础知识，是你现在就要开始学习的。早点去学习，以后的项目就都可以拿来锻炼，每写一行代码都是对内功的利用和加深，是可以受益一整个职业生涯的事情。

### 课堂讨论 ###

1. 聊一聊你对设计模式相关知识的重要性的看法；
2. 在你过往的项目开发中，有没有用过某种设计模式？是在什么场景下应用的？解决了什么问题？

### 精选留言 ###

## 02 | 从哪些维度评判质量的好坏？如何具备写出高质量代码的能力 ##

### 如何评价代码质量的高低？ ###

### 最常用的评价标准有哪几个？ ###

1. 可维护性
2. 可读性
3. 可扩展性
4. 灵活性
5. 简洁性
6. 可复用性（reusability）
7. 可测试性（testability）

### 如何才能写出高质量的代码？ ###

### 重点回顾 ###

1. 如何评价代码质量的高低？
2. 最常用的评价有哪几个？
3. 如何才能写出高质量的代码？

### 课程讨论 ###

## 03 | 面向对象、设计原则、设计模式、编程规范、重构、这五者有何关系 ##

### 面向对象 ###

面向过程、面向对象和函数式编程

* 面向对象的四大特性：封装、抽象、继承、多态
* 面向对象编程与面向过程编程的区别和联系
* 面向对象分析、面向对象设计、面向对象编程
* 接口和抽象类的区别以及各自的应用场景
* 基于接口而非实现编程的设计思想
* 多用组合少用继承的设计思想
* 面向过程的贫血模型和面向对象的充血模型

### 设计原则 ###

* SOLID原则-SRP单一职责原则
* SOLID原则-OCP开闭原则
* SOLID原则-LSP里式替换原则
* SOLID原则-ISP接口隔离原则
* SOLID原则-DIP依赖倒置原则
* DRY原则、KISS原则、YAGNI原则、LOD法则

### 设计模式 ###

#### 1. 创建型 ####

常用的有：单例模式、工厂模式（工厂方法和抽象工厂）、建造者模式

不常用的有：原型模式

#### 2. 结构型 ####

常用的有：代理模式、桥接模式、装饰器模式、适配器模式

不常用的有：门面模式、组合模式、享元模式

#### 3. 行为型 ####

常用的有：观察者模式、模板模式、策略模式、职责链模式、迭代器模式、状态模式。

不常用的有：访问者模式、备忘录模式、命令模式、解释器模式、中介模式。

### 编程规范 ###

编程规范主要解决的是代码的可读性问题。编码规范相对于设计原则、设计模式，更加具体、更加偏重代码细节。

### 代码重构 ###

* 重构的目的（why）、对象（what）、时机（when）、方法（how）
* 保证重构不出错的技术手段：单元测试和代码的可测试性
* 两种不同规模的重构：大重构（大规模高层次）和小重构（小规模低层次）

### 五者之间的联系 ###

* 面向对象编程因为其具有丰富的特性（封装、抽象、继承和多态），可以实现很多复杂的设计思路，是很多设计原则、设计模式等编码实现的基础。
* 设计模式是指导我们代码设计的一些经验总结，对于某些场景下，是否应该应用
* 设计模式是针对软件开发中经常遇到的一些设计问题，总结出来的一套解决方案或者设计思路。应用设计模式的主要目的是提高代码的可扩展性。从抽象程度上来讲，设计原则比设计模式更抽象。设计模式更加具体、更加可执行。
* 编程规范主要解决的是代码的可读性问题。编码规范相对于设计原则、设计模式，更加具体、更加偏重代码细节、更加能落地。持续的小重构依赖的理论基础主要就是编程规范。
* 重构作为保持代码质量不下降的有效手段，利用的就是面向对象、设计原则、设计模式、编码规范这些理论。

### 重点回顾 ###

# 设计原则与思想：面向对象 #

## 04 | 理论一：当我们谈论面向对象的时候，我们到底在谈论什么？ ##

面向对象的四大特性：封装、抽象、继承、多态。

### 什么是面向对象编程和面向对象编程语言？ ###

面向对象编程的英文缩写是 OOP，全称是 Object Oriented Programming。对应地，面向对象编程语言的英文缩写是 OOPL，全称是 Object Oriented Programming Language。

面向对象编程和面向对象编程语言。那究竟什么是面向对象编程？什么语言才算是面向对象编程语言呢？

* 面向对象编程是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。
* 面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

理解面向对象编程及面向对象编程语言两个概念，其中最关键的一点就是理解面向对象编程的四大特性。这四大特性分别是：封装、抽象、继承、多态。不过，关于面向对象编程的特性，也有另外一种说法，那就是只包含三大特性：封装、继承、多态，不包含抽象。为什么会有这种分歧呢？

在技术圈里，封装、抽象、继承、多态也并不是固定地被叫作“四大特性”（features），也有人称它们为面向对象编程的四大概念（concepts）、四大基石（cornerstones）、四大基础（fundamentals）、四大支柱（pillars）等等。

### 如何判定某编程语言是否是面向对象编程语言？ ###

实际上，面向对象编程从字面上，按照最简单、最原始的方式来理解，就是将对象或类作为代码组织的基本单元，来进行编程的一种编程范式或者编程风格，并不一定需要封装、抽象、继承、多态这四大特性的支持。

我个人觉得，只要某种编程语言支持类或对象的语法概念，并且以此作为组织代码的基本单元，那就可以被粗略地认为它就是面向对象编程语言了。

按照严格的定义，很多语言都不能算得上面向对象编程语言，但按照不严格的定义来讲，现在流行的大部分编程语言都是面向对象编程语言。

### 什么是面向对象分析和面向对象设计？ ###

面向对象编程（OOP），实际上，跟面向对象编程经常放到一块儿来讲的还有另外两个概念，那就是面向对象分析（OOA）和面向对象设计（OOD）。面向对象分析英文缩写是 OOA，全称是 Object Oriented Analysis；面向对象设计的英文缩写是 OOD，全称是 Object Oriented Design。OOA、OOD、OOP 三个连在一起就是面向对象分析、设计、编程（实现），正好是面向对象软件开发要经历的三个阶段。

### 什么是UML？我们是否需要UML？ ###

### 重点回顾 ###

#### 1. 什么是面向对象编程？ ####

面向对象编程是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。

#### 2. 什么是面向对象编程语言？ ####

面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

#### 3. 如何判定一个编程语言是否是面向对象编程语言？ ####

如果按照严格的的定义，需要有现成的语法支持类、对象、四大特性才能叫作面向对象编程语言。如果放宽要求的话，只要某种编程语言支持类、对象语法机制，那基本上就可以说这种编程语言是面向对象编程语言了，不一定非得要求具有所有的四大特性。

#### 4. 面向对象编程和面向对象编程语言之间有何关系？ ####

面向对象编程一般使用面向对象编程语言来进行，但是，不用面向对象编程语言，我们照样可以进行面向对象编程。反过来讲，即便我们使用面向对象编程语言，写出来的代码也不一定是面向对象编程风格的，也有可能是面向过程编程风格的。

#### 5. 什么是面向对象分析和面向对象设计？ ####

简单点讲，面向对象分析就是要搞清楚做什么，面向对象设计就是要搞清楚怎么做。两个阶段最终的产出是类的设计，包括程序被拆解为哪些类，每个类有哪些属性方法、类与类之间如何交互等等。

### 课堂讨论 ###

### 精选留言 ###

#### 1 ####

在这篇文章中，“面向对象编程”一词多义，不同的场景、语境下，解释不同。文章中没有点到这一点，我这里稍微补充说明一下：
1. 文章前半部分，面向对象编程指的是一种编程风格或者范式。
2. 文章后半部分，在讲到面向对象分析、设计、编程的时候，面向对象编程是一种行为。

#### 2 ####

## 05 | 理论二：封装、抽象、继承、多态分别可以解决哪些编程问题？ ##

### 封装（Encapsulation） ###

封装特性。封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式（或者叫函数）来访问内部信息或者数据。

### 抽象（Abstraction） ###

封装主要讲的是如何隐藏信息、保护数据，而抽象讲的是如何隐藏方法的具体实现，让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的。

在面向对象编程中，我们常借助编程语言提供的接口类（比如 Java 中的 interface 关键字语法）或者抽象类（比如 Java 中的 abstract 关键字语法）这两种语法机制，来实现抽象这一特性。

### 继承（Inheritance） ###

继承是用来表示类之间的 is-a 关系。从继承关系上来讲，继承可以分为两种模式，单继承和多继承。单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类。

为了实现继承这个特性，编程语言需要提供特殊的语法机制来支持，比如 Java 使用 extends 关键字来实现继承，C++ 使用冒号（class B : public A），Python 使用 paraentheses()，Ruby 使用 <。不过，有些编程语言只支持单继承，不支持多重继承，比如 Java、PHP、C#、Ruby 等，而有些编程语言既支持单重继承，也支持多重继承，比如 C++、Python、Perl 等。

**继承特性的定义讲完了，我们再来看，继承存在的意义是什么？它能解决什么编程问题？**

继承最大的一个好处就是代码复用。假如两个类有一些相同的属性和方法，我们就可以将这些相同的部分，抽取到父类中，让两个子类继承父类。这样，两个子类就可以重用父类中的代码，避免代码重复写多遍。不过，这一点也并不是继承所独有的，我们也可以通过其他方式来解决这个代码复用的问题，比如利用组合关系而不是继承关系。

### 多态（Polymorphism） ###

多态是指，子类可以替换父类。

多态这种特性也需要编程语言提供特殊的语法机制来实现。在上面的例子中，我们用到了三个语法机制来实现多态。

* 第一个语法机制是编程语言要支持父类对象可以引用子类对象，也就是可以将 SortedDynamicArray 传递给 DynamicArray。
* 第二个语法机制是编程语言要支持继承，也就是 SortedDynamicArray 继承了 DynamicArray，才能将 SortedDyamicArray 传递给 DynamicArray。
* 第三个语法机制是编程语言要支持子类可以重写（override）父类中的方法，也就是 SortedDyamicArray 重写了 DynamicArray 中的 add() 方法。

对于多态特性的实现方式，除了利用“继承加方法重写”这种实现方式之外，我们还有其他两种比较常见的的实现方式，

1. 一个是利用接口类语法
2. 另一个是利用 duck-typing 语法。

不过，并不是每种编程语言都支持接口类或者 duck-typing 这两种语法机制，比如 C++ 就不支持接口类语法，而 duck-typing 只有一些动态语言才支持，比如 Python、JavaScript 等。



设计原则与思想：设计原则

## 15 | 理论一：对于单一职责原则，如何判定某个类的职责是否够“单一”？ ##

经典的设计原则，其中包括，SOLID、KISS、YAGNI、DRY、LOD 等

### 如何理解单一职责原则（SRP）？ ###

SOLID 原则并非单纯的 1 个原则，而是由 5 个设计原则组成的，它们分别是：单一职责原则、开闭原则、里式替换原则、接口隔离原则和依赖反转原则，依次对应 SOLID 中的 S、O、L、I、D 这 5 个英文字母。

SOLID原则中的第一个原则：单一职责原则，Single Responsibility Principle，缩写为SRP。

原则描述的对象包好两个，一个是类（class），一个是模块（module）。在专栏中，有两种理解方式：

1. 把模块看作比类更加抽象的概念，类也可以看作模块
2. 把模块看作比类更加粗粒度的代码块，模块中包含多个类，多个类组成一个模块

单一职责原则的定义描述非常简单：一个类只负责完成一个职责或者功能。一个类包含了两个或者两个以上业务不相干的功能，那我们就说它职责不够单一，应该将它拆分成多个功能更加单一、粒度更细的类。

### 如何判断类的职责是否足够单一？ ###

在一个社交产品中，我们用下面的 UserInfo 类来记录用户的信息。

	public class UserInfo {
	  private long userId;
	  private String username;
	  private String email;
	  private String telephone;
	  private long createTime;
	  private long lastLoginTime;
	  private String avatarUrl;
	  private String provinceOfAddress; // 省
	  private String cityOfAddress; // 市
	  private String regionOfAddress; // 区 
	  private String detailedAddress; // 详细地址
	  // ...省略其他属性和方法...
	}

1. UserInfo 类包含的都是跟用户相关的信息，所有的属性和方法都隶属于用户这样一个业务模型，满足单一职责原则
2. 地址信息在 UserInfo 类中，所占的比重比较高，可以继续拆分成独立的 UserAddress 类，UserInfo 只保留除 Address 之外的其他信息，拆分之后的两个类的职责更加单一

不同的应用场景、不同阶段的需求背景下，对同一个类的职责是否单一的判定，可能都是不一样的。在某种应用场景或者当下的需求背景下，一个类的设计可能已经满足单一职责原则了，但如果换个应用场景或着在未来的某个需求背景下，可能就不满足了，需要继续拆分成粒度更细的类。

在真正的软件开发中，我们也没必要过于未雨绸缪，过度设计。*我们可以先写一个粗粒度的类，满足业务需求。随着业务的发展，如果粗粒度的类越来越庞大，代码越来越多，这个时候，我们就可以将这个粗粒度的类，拆分成几个更细粒度的类。这就是所谓的持续重构*

从侧面上判定一个类的职责是否够单一的小技巧：

* 类中的代码行数、函数或属性过多，会影响代码的可读性和可维护性，我们就需要考虑对类进行拆分；
* 类依赖的其他类过多，或者依赖类的其他类过多，不符合高内聚、低耦合的设计思想，我们就需要考虑对类进行拆分；
* 私有方法过多，我们就要考虑能否将私有方法独立到新的类中，设置为 public 方法，供更多的类使用，从而提高代码的复用性；
* 比较难给类起一个合适名字，很难用一个业务名词概括，或者只能用一些笼统的 Manager、Context 之类的词语来命名，这就说明类的职责定义得可能不够清晰；
* 类中大量的方法都是集中操作类中的某几个属性，比如，在 UserInfo 例子中，如果一半的方法都是在操作 address 信息，那就可以考虑将这几个属性和对应的方法拆分出来。

专业第六感

### 类的职责是否设计得越单一越好？ ###

### 重点回顾 ###

#### 1. 如何理解单一职责原则（SRP）？ ####

一个类只负责完成一个职责或者功能。不要设计大而全的类，要设计粒度小、功能单一的类。单一职责原则是为了实现代码高内聚、低耦合，提高代码的复用性、可读性、可维护性。

#### 2. 如何判断类的职责是否足够单一？ ####

不同的应用场景、不同阶段的需求背景、不同的业务层面，对同一个类的职责是否单一，可能会有不同的判定结果。实际上，一些侧面的判断指标更具有指导意义和可执行性，比如，出现下面这些情况就有可能说明这类的设计不满足单一职责原则：

* 类中的代码行数、函数或者属性过多；
* 类依赖的其他类过多，或者依赖类的其他类过多；
* 私有方法过多；
* 比较难给类起一个合适的名字；
* 类中大量的方法都是集中操作类中的某几个属性。

#### 3. 类的职责是否设计得越单一越好？ ####

单一职责原则通过避免设计大而全的类，避免将不相关的功能耦合在一起，来提高类的内聚性。类职责单一，类依赖的和被依赖的其他类也会变少，减少了代码的耦合性，以此来实现代码的高内聚、低耦合。但是，如果拆分得过细，实际上会适得其反，反倒会降低内聚性，也会影响代码的可维护性。

### 课堂讨论 ###

## 16 | 理论二：如何做到“对扩展开放，修改关闭”？扩展和修改各指什么 ##

扩展性是代码质量最重要的衡量标准之一。在 23 种经典设计模式中，大部分设计模式都是为了解决代码的扩展性问题而存在的，主要遵从的设计原则就是开闭原则。

### 如何理解“对扩展开放、修改关闭”？ ###



## 17 | 理论三：里式替换（LSP）跟多态有何区别？哪些代码违背了LSP? ##

## 18 | 理论四：接口隔离原则有哪三种应用？原则中的“接口”该如何理解？ ##