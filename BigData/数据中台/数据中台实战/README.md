# 数据中台实战课 #

开篇词

## 开篇词 | 数据中台，是陷阱？还是金钥匙？ ##

* 在原理篇中，我会告诉你数据中台的来龙去脉，数据仓库、数据湖、大数据平台以及数据中台的区别，以及它们有什么样的内在联系，然后会跟你讨论什么样的企业适合建数据中台。最后，我会从全局的视角出发，讲解数据中台如何在企业落地。
	* 什么是数据中台
	* 数据中台解决了什么问题
	* 如何来规划数据中台的建设。
* 实现篇是我讲解的重点，我会基于数据中台支撑技术的整体架构，逐一讲解每个模块的具体实现。
* 应用篇，基于数据中台之上的通用数据应用（包括自助取数、可视化分析等）。在这个过程中，我会以电商场景为例，通过大量的案例，帮助你理解这些问题以及问题的解决过程。

### 精选留言 ###

原先大数据平台，应该说就能够支撑数据研发链路的覆盖。数据中台更加关注在数据研发的效率、质量和成本三个方面。
其次，数据其中，产生更大的价值，更少的接口，更快的数据服务。
这个观点是正确的，数据的复用，提高了数据研发的效率。数据通过接口化的方式，提高了数据的接入效率和接入后数据的管理效率。

**Q**

郭老师，我理解数据中台是这样的，您看对不对啊。
就是把不同系统的数据，全部汇总到一个大的数据仓库。然后在数据仓库里各种数据的清洗 转化 装载 集成等工作，最后数据建模，把业务数据可视化的展现出来。
老师您看哪里理解的不对或有遗漏。

**A**

你说的这个过程，在我看来，只能叫数据仓库。
数据中台的核心并不是要建数据仓库，他的核心在于“OneData”数据的复用和共享，所以强调数据只加工一次，这样才能高效的支撑前台的需求。这才是数据中台的精髓。
别急，你可以接着往后看，尤其是看看第一讲，我会详细的介绍数据中台、数据平台、数据仓库的区别，你就会明白了。至于“OneData”，你可以看第3讲，我会展开详细的介绍，包括方法论、支撑技术以及组织架构上的支持。


原理篇

## 01 | 前因后果：为什么说数据中台是大数据的下一站？ ##

与你深入大数据的发展历史，先从数据仓库的出现讲起，途径数据湖，再到大数据平台

### 启蒙时代：数据仓库的出现 ###

数据分析需要聚合多个业务系统的数据，比如需要集成交易系统的数据，需要集成仓储系统的数据等等，同时需要保存历史数据，进行大数据量的范围查询。传统数据库面向单一业务系统，主要实现的是面向事务的增删改查，已经不能满足数据分析的场景，**这促使数据仓库概念的出现。**

数据仓库是在其他管理和决策中面向主题的、集成的、与时间相关的，不可修改的数据集合。

主题域是业务过程的一个高层次的抽象，像商品、交易、用户、流量都能作为一个主题域，**你可以把它理解为数据仓库的一个目录**。

* 恩门建模方法自顶向下这里的顶是指数据的来源，在传统数据仓库中，就是各个业务数据库），基于业务中各个实体以及实体之间的关系，构建数据仓库。
* 金博尔建模自底向上，从数据分析的需求触发，拆分维度和事实
* 恩门建模因为是从数据源开始构建，构建成本比较高，适用于应用场景比较固定的业务，比如金融领域，冗余数据少是它的优势。
* 比如金融领域，冗余数据少是它的优势。金博尔建模由于是从分析场景出发，适用于变化速度比较快的业务，比如互联网业务。

### 技术革命：从 Hadoop 到数据湖 ###

进入互联网时代，有两个最重要的变化。

* 数据规模前所未有，传统数据仓库难于扩展，根本无法承载如此规模的海量数据。
* 数据类型变得异构化，联网时代的数据除了来自业务数据库的结构化数据，还有来自 App、Web 的前端埋点数据，或者业务服务器的后端埋点日志，这些数据一般都是半结构化，甚至无结构的。传统数据仓库对数据模型有严格的要求，在数据导入到数据仓库前，数据模型就必须事先定义好，数据必须按照模型设计存储。

Hadoop 相比传统数据仓库主要有两个优势：

1. 完全分布式，易于扩展，可以使用价格低廉的机器堆出一个计算、存储能力很强的集群，满足海量数据的处理要求；
2. 弱化数据格式，数据被集成到 Hadoop 之后，可以不保留任何数据格式，数据模型与数据存储分离，数据在被使用的时候，可以按照不同的模型读取，满足异构数据灵活分析的需求。

数据湖（Data Lake）是一个以原始格式存储苏火炬的存储库或系统。


缺陷：
数据湖拉开了 Hadoop 商用化的大幕，但是一个商用的 Hadoop 包含 20 多种计算引擎， 数据研发涉及流程非常多，技术门槛限制了 Hadoop 的商用化进程。那么如何让数据的加工像工厂一样，直接在设备流水线上完成呢？

### 数据工厂时代：大数据平台兴起 ###

大数据平台是面向数据研发场景的，覆盖数据研发的完整链路的数据工作台

![c40f3215cae131c16c5d33f127580bf6](img/c40f3215cae131c16c5d33f127580bf6.jpg)

大数据平台按照使用场景，分为数据集成、数据开发、数据测试……任务运维，大数据平台的使用对象是数据开发。大数据平台的底层是以 Hadoop 为代表的基础设施，分为计算、资源调度和存储。

Hive、Spark、Flink、Impala 提供了大数据计算引擎：

* Hive、Spark 主要解决离线数据清洗、加工的场景，目前，Spark 用得越来越多，性能要比 Hive 高不少；
* Flink 主要是解决实时计算的场景；
* Impala 主要是解决交互式查询的场景。

**调度工具**

* Yarn：这些计算引擎统一运行在一个称为 Yarn 的资源调度管理框架内，由 Yarn 来分配计算资源。
* Kubernetes，实现在线和离线的资源混合部署，节省机器成本。

**数据存储**

数据存储在 HDFS、Kudu 和 HBase 系统内：

* HDFS 不可更新，主要存全量数据
* HBase 提供了一个可更新的 KV，主要存一些维度表
* Kudu 提供了实时更新的能力，一般用在实时数仓的构建场景中

### 数据价值时代：数据中台崛起 ###

* 不同业务线，甚至相同业务线的不同应用之间，数据都是割裂的
	* 导致的后果，两个数据应用的相同指标，展示的结果不一致，导致运营对数据的信任度下降。
	* 大量的重复计算、开发，导致的研发效率的浪费，计算、存储资源的浪费，大数据的应用成本越来越高。

数据中台的核心，是避免数据的重复计算，通过数据服务化，提高数据的共享能力，赋能数据应用。

### 课堂总结 ###

为什么说数据中台是大数据的下一站？

1. 数据中台构建于数据湖之上，具备数据湖异构数据统一计算、存储的能力，同时让数据湖中杂乱的数据通过规范化的方式管理起来。
2. 数据中台需要依赖大数据平台，大数据平台完成了数据研发的全流程覆盖，数据中台增加了数据治理和数据服务化的内容。
3. 数据中台借鉴了传统数据仓库面向主题域的数据组织模式，基于维度建模的理论，构建统一的数据公共层。

### 思考时间 ###

如果说数据中台是大数据的下一站，那数据中台的下一站是什么？

## 02 | 关键抉择：到底什么样的企业应该建数据中台？ ##

### 建设中台前，我们面临的挑战 ###

大量数据产品的出现，在不断提高企业运营效率的同时，也暴露出很多尖锐的问题，在我看来，主要有五点。

1. 指标口径不一致
2. 数据重复建设，需求响应时间长。
3. 取数效率低，数据开发大部分的时间都被临时取数的需求占据，根本无法专注在数仓模型的构建和集市层数据的建设，最终形成了一个恶性循环，一方面是数据不完善，另一方面是数据开发忙于各种临时取数需求。
4. 数据质量差
5. 数据成本线性增长

### 为什么数据中台可以解决这些问题？ ###

**指标口径不一致**

指标口径不一致，可能原因包括三种：

* 业务口径不一致
* 计算逻辑不一致
* 数据来源不一致

*综合看来，要实现一致，就务必确保对同一个指标，只有一个业务口径，只加工一次，数据来源必须相同。*

**数据需求响应慢**在于烟囱式的开发模式，导致了大量重复逻辑代码的研发：

*所以，要解决数据需求响应慢，就必须解决数据复用的问题，要确保相同数据只加工一次，实现数据的共享。*

**取数效率低**一方面原因是找不到数据，另一方面原因可能是取不到数据。

* 找不到数据：就必须要构建一个全局的企业数据资产目录，实现数据地图的功能，快速找到数据
* 取不到数据：提供可视化的查询平台，通过勾选一些参数，才更容易使用

**数据质量差**其实是数据问题很难被发现。我们经常是等到使用数据的人反馈投诉，才知道数据有问题。一个指针上游的所有链路加起来有100多个节点，然后再重跑这个任务以及所有下游链路上的每个任务，最终导致故障恢复的效率很低，时间很长。

*所以，要解决数据质量差，就要及时发现然后快速恢复数据问题。*

**大数据成本问题**成本问题背后也是数据重复建设的问题。

数据中台到底是怎么一回事儿呢？*在我看来，数据中台是企业构建的标准的、安全的、统一的、共享的数据组织，通过数据服务化的方式支撑前端数据应用。*

### 数据中台是如何解决这些问题的？ ###

1. 管好指标：在数据中台，必须有一个团队统一负责指标口径的管控。
2. 指标体系化管理：在指标系统中，我们会明确每个指标的业务口径，数据来源和计算逻辑，同时会按照类似数仓主题域的方式进行管理。
3. 确保所有的数据产品、报表都引用指标系统的口径定义。

*那么数据中台是怎么实现所有数据只加工一次的呢？*对于数仓数据，我们要求相同粒度的度量或者指标只加工一次，构建全局一致的公共维表。要实现上述目标，需要两个工具产品：

* 数仓设计中心，在模型设计阶段，强制相同聚合粒度的模型，度量不能重复。
* 数据地图，方便数据开发能够快速地理解一张表的准确含义

* **数据中台通过服务化的方式，提高了数据应用接入和管理的效率**。原先数仓提供给应用的访问方式是直接提供表，应用开发自己把数据导出到一个查询引擎上，然后去访问查询引擎。在数据中台中，数仓的数据是通过 API 接口的方式提供给数据应用，数据应用不用关心底层不同的查询引擎访问方式的差异。
* **对于非技术人员，数据中台提供了可视化的取数平台**。只需要选取指标、通过获取指标系统中每个指标的可分析维度，然后勾选，添加筛选过滤条件，点击查询，就可以获取数据。 
* **数据中台由于数据只能加工一次，强调数据的复用性，这就对数据的质量提出了更高的要求。**全链路的数据质量稽核监控，对一个指标的产出上游链路中涉及的每个表，都实现了数据一致性、完整性、正确性和及时性的监控，确保在第一时间发现、恢复、通知数据问题。
* **最后一个是成本问题。**研发了一个数据成本治理系统，从应用维度、表维度、任务的维度、文件的维度进行全面的治理。 
	* 从应用的维度，如果一个报表 30 天内没有访问，这个报表的产出价值就是低的
	* 结合这个报表产出的所有上游表以及上游表的产出任务，我们可以计算加工这张表的成本
	* 有了价值和成本，我们就能计算 ROI
	* 根据 ROI 就可以实现将低价值的报表下线的功能 

### 什么样的企业适合建数据中台？ ###

数据中台的建设，需要结合企业的现状，根据需要进行选择。我认为企业在选择数据中台的时候，应该考虑这样几个因素。

1. 企业是否有大量的数据应用场景： 数据中台本身并不能直接产生业务价值，数据中台的本质是支撑快速地孵化数据应用。所以当你的企业有较多数据应用的场景时（一般有 3 个以上就可以考虑），就像我在课程开始时提到电商中有各种各样的数据应用场景，此时你要考虑构建一个数据中台。
2. 经过了快速的信息化建设，企业存在较多的业务数据的孤岛，需要整合各个业务系统的数据，进行关联的分析。比如在我们做电商的初期，仓储、供应链、市场运营都是独立的数据仓库，当时数据分析的时候，往往跨了很多数据系统，为了消除这些数据孤岛，就必须要构建一个数据中台。
3. 当你的团队正在面临效率、质量和成本的苦恼时，面对大量的开发，却不知道如何提高效能，数据经常出问题而束手无策，老板还要求你控制数据的成本，这个时候，数据中台可以帮助你。当你所在的企业面临经营困难，需要通过数据实现精益运营，提高企业的运营效率的时候，你需要构建一个数据中台，同时结合可视化的 BI 数据产品，实现数据从应用到中台的完整构建，在我的接触中，这种类型往往出现在传统企业中。
4. 企业规模也是必须要考虑的一个因素，数据中台因为投入大，收益偏长线，所以更适合业务相对稳定的大公司，并不适合初创型的小公司。

### 课堂总结 ###

* 效率、质量和成本是决定数据能否支撑好业务的关键，构建数据中台的目标就是要实现高效率、高质量、低成本。
* 数据只加工一次是建设数据中台的核心，本质上是要实现公共计算逻辑的下沉和复用。
* 如果你的企业拥有 3 个以上的数据应用场景，数据产品还在不断研发和更新，你必须要认真考虑建设数据中台。

![1a03abc87fb3bd691a03d2a56c974e9c.jpg](img/1a03abc87fb3bd691a03d2a56c974e9c.jpg)

### 思考时间 ###

留给你一道思考题，一个企业是不是只能建设一个数据中台？

## 03 | 数据中台建设三板斧：方法论、组织和技术 ##

如何建设数据中台

* 有的观点说，数据中台是一种数据建设的方法论，按照数据中台设计方法和规范实施就可以建成数据中台了；
* 也有观点认为，数据中台的背后是数据部门组织架构的变更，把原先分散的组织架构形成一个统一的中台部门，就建成了数据中台；
* 除此之外，你可能还听到过一些大数据公司说，他们可以卖支撑数据中台建设的产品技术。

### 数据中台建设方法论 ###

OneData 和 OneService

#### OneData ####

用一句话定义 OneData 的话，就是所有数据只加工一次。 

![111bdb91bcc9f36ea3da013a3bca610d.jpg](img/111bdb91bcc9f36ea3da013a3bca610d.jpg)

而数据中台就是要在整个电商业务形成一个公共数据层，消灭这些跨部门的小数仓，实现数据的复用，所以强调数据只加工一次，不会因为不同的应用场景，不同的部门数据重复加工。

![39c72956708fe40c781ce0e03dfb7508.jpg](img/39c72956708fe40c781ce0e03dfb7508.jpg)

存在几万张表，同时又有几十个数据开发维护这些表，如何来确保这些表的管理效率？ 

1. 选择划主题域。
2. 对表的命名进行规范化统一，表的名称中最好能够携带表的主题域、业务过程、分层以及分区信息。

对于仓储域下的一张入库明细表，规则命名可以是：

![251a20233507361d8795277a4ef8edd0.jpg](img/251a20233507361d8795277a4ef8edd0.jpg)

数据中台适合采用分层的设计方式，常见的分层包括：ODS 原始数据层，DWD 明细数据层，DWS 轻度汇总数据层，ADS/DM 应用数据层 / 数据集市层。**数据中台的数据必须尽可能的覆盖所有的业务过程**。

OneData 体系的目标是构建统一的数据规范标准，让数据成为一种资产，而不是成本。资产和成本的差别在于资产是可以沉淀的，是可以被复用的。成本是消耗性质的、是临时的、无法被复用的。

### OneService ###

OneService，数据即服务，强调数据中台中的数据应该是通过 API 接口的方式被访问。

API 接口一方面对应用开发屏蔽了底层数据存储，使用统一标准的 API 接口查询数据，提高了数据接入的速度。另一方面，对于数据开发，提高了数据应用的管理效率，建立了表到应用的链路关系。

* **屏蔽异构数据源**：数据服务必须要能够支撑类型丰富的查询引擎，满足不同场景下数据的查询需求，常见的有 MySQL、HBase、Greenplum、Redis、Elasticsearch 等。
* **数据网关**：要实现包括权限、监控、流控、日志在内的一系列管控能力
	* 哪个应用的哪个页面访问了哪个模型，要做到实时跟踪，如果有一些模型长时间没有被访问，应该予以下线。
	* 使用数据的每个应用都应该通过 accesskey 和 secretkey 实现身份认证和接口权限的管理。
	* 另外，访问日志可以方便在访问出现问题时，加快排查速度。
* **逻辑模型**：逻辑模型可以类比视图，它可以帮助应用开发者屏蔽底层的数据物理实现，实现相同粒度的数据构造一个逻辑模型，简化了数据接入的复杂度。
* **性能和稳定性**：由于数据服务侵入到用户的访问链路，所以对服务的可用性和性能都有很高的要求，数据服务必须是无状态的，可以做到横向扩展。

### 数据中台支撑技术 ###

![8da01dbcf1f318fcf90d3c26e3f1b602.jpg](img/8da01dbcf1f318fcf90d3c26e3f1b602.jpg)

描述了数据中台支撑技术体系，它的底层是以 Hadoop 为代表的大数据计算、存储基础设施，提供了大数据运行所必须的计算、存储资源。

以 HDFS 为代表的分布式文件系统，以 Yarn/Kubernates 为代表的资源调度系统，以 Hive、Spark、Fink 为代表的分布式计算引擎，都属于基础设施范畴。如果把数据中台比作是一个数据工厂，那可以把它们比作是这个工厂的水、电。

在 Hadoop 之上，浅绿色的部分是原有大数据平台范畴内的工具产品，覆盖了从数据集成、数据开发、数据测试到任务运维的整套工具链产品。同时还包括基础的监控运维系统、权限访问控制系统和项目用户的管理系统。由于涉及多人协作，所以还有一个流程协作与通知中心。

在 Hadoop 之上，浅绿色的部分是原有大数据平台范畴内的工具产品，覆盖了从数据集成、数据开发、数据测试到任务运维的整套工具链产品。同时还包括基础的监控运维系统、权限访问控制系统和项目用户的管理系统。由于涉及多人协作，所以还有一个流程协作与通知中心。

灰色的部分，是数据中台的核心组成部分：数据治理模块。它对应的方法论就是 OneData 体系。以元数据中心为基础，在统一了企业所有数据源的元数据基础上，提供了包括数据地图、数仓设计、数据质量、成本优化以及指标管理在内的 5 个产品，分别对应的就是数据发现、模型、质量、成本和指标的治理

深绿色的部分是数据服务，它是数据中台的门户，对外提供了统一的数据服务，对应的方法论就是 OneService。数据服务向下提供了应用和表的访问关系，使数据血缘可以延申到数据应用，向上支撑了各种数据应用和服务，所有的系统通过统一的 API 接口获取数据。

在数据服务之上，是面向不同场景的数据产品和应用，包括面向非技术人员的自助取数系统；面向数据开发、分析师的自助分析系统；面向敏捷数据分析场景的 BI 产品；活动直播场景下的大屏系统；以及用户画像相关的标签工厂。

### 组织架构 ###

各个部门都会存在一些小的数仓，那么你有没有想过，*为什么会存在这些分散的小数仓*？

因为建设这些数仓的人分散在各个业务部门。

数据中台提供的是一个跨业务部门共享的公共数据能力，所以，承担数据中台建设职责的部门一定是一个独立于业务线的部门。但独立部门的最大的风险是与业务脱节，所以我们对数据中台的组织定位是：懂业务，能够深入业务，扎根业务。

### 课堂小结 ###

建设数据中台的经历，带领你了解了数据中台建设的三板斧：方法论、支撑技术和组织架构。

* 适合数据中台的组织架构是建设数据中台的第一步，数据中台组织一定是独立的部门，同时要避免与业务脱节，深入业务，要与业务目标绑定。
* 数据中台支撑技术大规模落地，需要有成熟的系统工具作为支撑，同时要注意这些系统工具之间的联动和打通。
* 据中台的方法论可以借鉴，但是不能完全照搬，每个公司的数据应用水平和当前遇到的问题都不相同，可以针对这些问题，分阶段制定数据中台的建设计划，选择性的应用一些技术，例如当前最主要的问题是数据质量问题，那就应该优先落地数据

如何建设数据中台？在我看来，方法论、支撑技术和组织架构，对于建设数据中台，三者缺一不可。而且我想再强调一下，数据中台的建设绝对不是为了建中台而建中台，数据中台的建设一定要结合落地场景，可以先从从一些小的场景开始，但是规划一定是要有顶层设计的。

![afedf9dca0f4366ff3fad9ef2f44b952.jpg](img/afedf9dca0f4366ff3fad9ef2f44b952.jpg)

### 思考时间 ###

哪些数据中台建设的方法论和支撑技术是适合你当前的公司的，如果你们要做数据中台，你所在的组织架构要做哪些变动。

## 特别放送｜史凯：建设数据中台到底有什么用？ ##
	
### 数据中台火了，我们的诉求是什么？ ###

数据中台最多的期待：

* 距离业务更近；
* 为企业提供直接的业务价值；
* 提供数据服务而不仅是报表。

过去企业的数据系统距离用户和业务比较远:

*如果用一句话来说数据中台的价值，那就是改变原来企业利用数据的形式*。

### 建设数据中台的根本目的是什么？ ###

数据中台的愿景是打造数据驱动的智能企业。

### 优化现有业务 ###

#### 第一，增加现有业务的收入 ####

### 总结 ###



实现篇

## 04 | 元数据中心的关键目标和技术实现方案 ##

所以你必须要掌握元数据的管理，才能构建一个数据中台。

### 元数据包括哪些？ ###

元数据划为三类：数据字典、数据血缘和数据特征。

* 数据字典描述的是数据的结构信息
* 数据血缘是指一个表是直接通过哪些表加工而来，做影响分析和故障溯源。
* 数据特征主要是指数据的属性信息

-----

数据字典描述

![706050b3ef2c71001ecd94158efe55b6.jpg](img/706050b3ef2c71001ecd94158efe55b6.jpg)

-----

数据血缘

dws_trd_sku_1d 是通过 dwd_trd_order_df 的数据计算而来，所以，dwd_trd_order_df 是 dws_trd_sku_1d 的上游表。

-----

数据特征

![d5303f16e5a969f039080e413d26201b.jpg](img/d5303f16e5a969f039080e413d26201b.jpg)

### 业界元数据中心产品 ###

业界的比较有影响力的产品：

* 开源的有 Netflix 的 Metacat、Apache Atlas；
	* Metacat：擅长于管理数据字典
	* Apache Atlas：管理数据血缘
* 商业化的产品有 Cloudera Navigator。

#### Metacat 多数据源集成型架构设计 ####

![ca1fd21c2109b921c680008469dd663f.jpg](img/ca1fd21c2109b921c680008469dd663f.jpg)

Metacat没有单独再保存一份元数据，而是采取直连数据源拉的方式，这种方式的优点：

1. 不存在保存两份元数据一致性的问题
2. 轻量化，每个数据源只要实现一个连接实现类即可，扩展成本很低

#### Apache Atlas 实时数据血缘采集 ####

* 通过静态解析SQL，获得输入表和输出表；如果任务没有执行，将面临正确性的问题。
* 通过实时抓取正在执行的SQL，解析执行计划，获取输入表和输出表；
* 通过任务日志解析的方式，获取执行后的SQL输入表和输出表。需要分析大量的任务日志数据。

![b96e93b2ea7548fbd8bcb15eab93988c.jpg](img/b96e93b2ea7548fbd8bcb15eab93988c.jpg)

### 网易元数据中心设计 ###

元数据中心必须实现的5个关键目标：

**其一，多业务线、多租户支持。**

有多个不同的业务线，同一个业务线内也分为算法、数仓、风控等多个租户

**其二，多数据源的支持**

元数据中心必需要能够支持不同类型的数据源（比如 MySQL、Hive、Kudu 等），同时还要支持相同数据源的多个集群。还需要考虑将半结构化的 KV 也纳入元数据中心的管理（比如 Kafka、Redis、HBase 等）

需要能够在元数据中心里定义 Kafka 每个 Topic 的每条记录 JSON 中的格式，每个字段代表什么含义。

**其三，数据血缘**

* 元数据中心需要支持数据血缘的实时采集和高性能的查询。同时，还必须支持字段级别的血缘。
* 数据血缘还必须要支持生命周期管理（已经下线的任务应该立即清理血缘，血缘要保留一段时间，如果没有继续被调度，过期的血缘关系应该予以清理。）

字段血缘在做溯源的时候非常有用，因为大数据加工链路的下游是集市层，为了方便使用者使用，一般都是一些很宽的表（列很多的表，避免 Join 带来的性能损耗），这个表的上游可能是有几十个表产生的，如果不通过字段血缘限定溯源范围，就会导致搜索范围变得很大，无法快速地精准定位到有问题的表。

**其四，与大数据平台集成。**

* 权限：
* 统一接口

权限：元数据中心需要与 Ranger 集成，实现基于 tag 的权限管理方式。在元数据中心中可以为表定义一组标签，Ranger 可以基于这个标签，对拥有某一个标签的一组表按照相同的权限授权。

**其五，数据标签。**

元数据中心必须要支持对表和表中的字段打标签，通过丰富的不同类型的标签，可以完善数据中台数据的特征。

比如指标可以作为一种类型的标签打在表上，主题域、分层信息都可以作为不同类型的标签关联到表。

![d590abca0d8f54d19fa413696dfd97f4.jpg](img/d590abca0d8f54d19fa413696dfd97f4.jpg)

* 数据血缘由采集端、消息中间件、消费端以及血缘清理模块组成，基于 Hive Hook，Spark Listener，Flink Hook ，可以获取任务执行时输入表和输出表，推送给统一的消息中间件（Kafka），然后消费端负责将血缘关系沉淀到图数据库中。
* 图数据库选择 Neo4j，主要考虑是性能快、部署轻量化、依赖模块少，当然，开源的 Neo4j 没有高可用方案，并且不支持水平扩展，但是因为单个业务活跃的表规模基本也就在几万的规模，所以单机也够用，高可用可以通过双写的方式实现。
* 血缘还有一个清理的模块，主要负责定时清理过期的血缘，一般我们把血缘的生命周期设置为 7 天。
* 数据字典部分，我们参考了 Metacat 实现，我们由一个统一的 Connector Mananger 负责管理到各个数据源的连接。对于 Hive、MySQL，元数据中心并不会保存系统元数据，而是直接连数据源实时获取。对于 Kafka、HBase、Redis 等 KV，我们在元数据中心里内置了一个元数据管理模块，可以在这个模块中定义 Value 的 schema 信息。
* 数据特征主要是标签的管理以及数据的访问热度信息。元数据中心内置了不同类型的标签，同时允许用户自定义扩展标签类型。指标、分层信息、主题域信息都是以标签的形式存储在元数据中心的系统库里，同时元数据中心允许用户基于标签类型和标签搜索表和字段。
* 元数据中心统一对外提供了 API 访问接口，数据传输、数据地图、数据服务等其他的子系统都可以通过 API 接口获取元数据。另外 Ranger 可以基于元数据中心提供的 API 接口，获取标签对应的表，然后根据标签更新表对应的权限，实现基于标签的权限控制。

### 数据地图：元数据中心的界面 ###

数据地图是基于元数据中心构建的一站式企业数据资产目录，可以看作是元数据中心的界面。

数据地图提供了多维度的检索功能，使用者可以按照表名、列名、注释、主题域、分层、指标进行检索，结果按照匹配相关度进行排序。考虑到数据中台中有一些表是数仓维护的表，有一些表数仓已经不再维护，在结果排序的时候，增加了数仓维护的表优先展示的规则。同时数据地图还提供了按照主题域、业务过程导览，可以帮助使用者快速了解当前有哪些表可以使用。

### 课程总结 ###

元数据应该包括数据字典、数据血缘和数据特征，然后通过分析两个业界比较有影响力的元数据中心产品（metacat和apache atlas），结合我在网易数据中台实践，给出了元数据中心设计的 5 个关键特性和技术实现架构，最后介绍了基于元数据中心之上的数据地图产品。我想在最后强调几个关键点：

* 元数据中心设计上必须注意扩展性，能够支持多个数据源，所以宜采用集成型的设计方式。
* 数据血缘需要支持字段级别的血缘，否则会影响溯源的范围和准确性。
* 数据地图提供了一站式的数据发现服务，解决了检索数据，理解数据的“找数据的需求”。

元数据中心是数据中台的基石，它提供了我们做数据治理的必须的数据支撑。

![069ede4c461619307896563cbf681063.jpg](img/069ede4c461619307896563cbf681063.jpg)

### 课程思考 ###

介绍了血缘采集的三种方式，并且推荐了通过实时采集的方式，但是其实静态解析血缘也有它的优势应用场景

## 05 | 如何统一管理纷繁杂乱的数据指标？ ##

指标管理，指标是一种特定类型的元数据，它是业务和数据的交汇点。

*标口径不一致*

### 指标混乱现状 ###

## 06 | 数据模型无法复用，归根结底还是设计问题 ##

## 07 | 同事老打脸说数据有问题，该怎么彻底解决 ##

## 08 | 交付速度和质量问题解决了，老板说还得“省” ##

## 09 （一）|数据服务到底解决了什么问题？ ##

## 09 （二）|数据服务难道就是对外提供个API吗？ ##

## 10 |怎么一劳永逸得地解决数据安全问题？ ##

## 11 |数据的台子搭完了，但你还得想好戏怎么唱 ##

## 12（一）|数据研发就只是写代码吗？ ##

## 12（二）|数据被加工后，你还要学会使用和管理数据？ ##

## 13 | 数据中台在网易电商业务的最佳实践 ##

*避免*：没有深入调研业务问题，也没有和业务达成一致的 KPI，更没有根据业务的反馈，不断完善数据应用。

要建中台，要做到这样几点：

* 问问自己为什么要建中台，与业务达成一致的目标；
* 把数据中台作为一个公司级别的顶级项目来推进，而不是一个数据部门自己的 KPI；
* 数据中台必须要有清晰的、可量化的价值来衡量（从主观上也要得到业务部门的认可）。

### 立项数据中台项目 ###

立项是建数据中台最关键的一步，因为它的核心就是挖掘业务的痛点，跟业务达成一致的建设目标。**如果能达成一个一致的、可量化的目标，数据中台的项目就成功了一半。**

**第一，指标业务口径不一致。**

**第二，需求响应速度慢。**

运营人员就需要分析大量的数据，从而不断优化运营策略。此时，数据部门会收到大量的数据研发需求。而我们统计后发现，数据部门一个需求的平均交付时间是一周（数据来源于项目管理工具 JIRA），根本没办法满足业务部门的需求，可以这么说，数据研发的速度已经无法支撑业务高频的运营活动。

**第三，取数效率低。**

1. 不知道有哪些数据，也不知道到哪里去找数据。
2. 基于 SQL 取数，对于非技术人员来说，门槛比较高。

**第四，数据经常违反常识。**

* 平均每周，我们就有 10 个数据质量问题被业务方投诉。
* 更为可怕的是，这些问题中，90% 都是由业务方先于数据提供方发现的问题，然后 50% 都是因为数据研发的 BUG 导致。
	在当时，我们经常出现数据经常无法按时产出，数据修复需要花费一天的时间！* 

**第五，数据成本指数级增长。**

* **商品部门**:主要目标是优化商品结构、降低滞销商品比例、提高商品库存周转，从而达到控制毛利水平的目标。所以他们最紧急的就是监控平台上滞销的商品。
* **供应链部门**：主要目标是尽可能保证商品的供货充足，尽量避免缺货商品出现。所以及时发现缺货商品，制订更精准的采购计划是最紧急的事儿。
* **仓配客部门**：最重要的业务目标是保障商品及时送达，优化物流成本。所以，基于各个仓库的数据和物流公司的报价，制订最合理的配送计划，是他们最重要的事儿。

从效率、质量和成本三个方面，和业务部门制订了共同的 KPI。同时又因为当时整个电商业务的核心方向是控制毛利水平，提高商品周转，所以在业务目标上，我们选择了与之最相关的商品和供应链部门进行合作，共背业绩 KPI。

在 CTO 的推动下，供应链、仓配以及市场部门把指标梳理、自助取数、数据模型迁移中台纳入了 KPI 考核。当然，对数据中台的支撑工作，这部分在业务部门的 KPI 中比例不会很高，一般最多 20%，但是却很重要，因为只有这样，业务部门才有压力去做这个事情。

### 推进数据中台项目落地 ###

#### 第一步，调整团队组织架构，明确各个团队的职责。 ####

在数据中台构建之前，电商业务主要存在 3 个独立的数仓：市场、供应链和仓配客。这些业务部门中有数据开发、数据产品还有分析师。

1. 成立数据中台团队，这个团队是在原有市场数仓（除了服务市场，还服务于管理层）的基础上建起来的。
2. 对供应链和仓配客，没有立即把他们的数据开发团队并入中台团队；而是调整了团队职责，把他们的数据开发的职责调整成，基于数据中台数据，加工私有的集市层和应用层。

建立数据中台团队之后（主要由 3 名数据产品和 15 个数据开发构成），接下来就是明确团队的职责。数据中台主要负责 DW 层公共数据，以及跨部门共享的集市层和应用层的数据建设。

![62199242b5b44685c912ae22fca96f1c.jpg](img/62199242b5b44685c912ae22fca96f1c.jpg)

#### 第二步，数据整合。 ####

**指标阶段**

1. 面对的是混乱的指标业务口径，要先梳理指标，，建立全局的指标管理规范（对应咱们的 05 讲）。
2. 对模型进行重构、整合和迁移（对应咱们的 06 讲）

**设计阶段**

根据梳理好的指标，构建主题域，然后在原有模型的基础上进行重新设计，构建一致性维度。一旦原始数据没有管住，那中台就会功亏一篑。

**实施阶段**

中台团队还承担着公共数据需求的研发，所以为了保证模型重构和迁移的进度，我们从 15 个数据开发中拆出了 5 个人，专门进行模型的重构和迁移。

#### 第三步，研发工具产品。 ####

![a0604418589bb759adf3dd89000ef9d7.jpg](img/a0604418589bb759adf3dd89000ef9d7.jpg)

研发了 20 多个数据中台支撑技术产品，总结了四个产品设计的经验：
* 正交化产品设计。每个产品聚焦一个应用场景，构建产品矩阵，简化了系统使用的复杂度。
* 全链路打通，形成产品闭环。比如任务运维中心与有数报告打通，可以看到一个任务影响了哪些下游报表。
* 组件式产品架构，允许业务根据场景搭配产品使用，形成面向不同场景的解决方案能力，例如数据质量解决方案、成本优化解决方案。
* 轻型易用、降低用户门槛，尤其注重非技术人员的交互体验。 

![aa63b1aeae14909d51a5aa5bf0890135.jpg](img/aa63b1aeae14909d51a5aa5bf0890135.jpg)

#### 第四，数据产品构建。 ####

商品和供应链。分别研发了商品运营系统和供应链辅助决策系统，大幅度提升了业务决策的效率。数据产品团队，我们有 10 个人的团队规模，主要负责数据产品研发。

### 总结数据中台项目成果 ###

### 课堂小结 ###

用网易电商建设数据中台的案例，从项目立项、推进、成果总结，让你看到了数据中台在企业落地的完整过程。**最后，我想用一句话来总结今天的内容，那就是：数据中台从业务中来，到业务中去！同时我还想送给要建设数据中台的人一句话，“建设数据中台，不仅需要技术的思维，更需要管理者的视角”。**

![cf934a2f72617bdeed632ca0e77ffd07.jpg](img/cf934a2f72617bdeed632ca0e77ffd07.jpg)

### 思考时间 ###

所有关于数据中台的建设规范，我们最终都沉淀到了工具产品中，形成了产品化的解决方案，你知道这是为什么么？

### 精选留言 ###

**A**

数据中台建设，我们踩过的坑
1 要得到高层的支持，由公司层面推进。最好由CEO直接负责。
2 统一数据口径，数据中台是唯一的数据输出平台。业务部门不用也得用了。
3 与业务部门利益绑定okr对齐，让业务参与数据中台的建设。
4 其他技术部门的联动，毕竟数据部门是下游系统，凡事都要靠上游输送数据。
5 成本优化，整合了各个部门的数仓，节省了资源，汇报的时候才有成果。



结束语

## 结束语 | 数据中台从哪里来，要到哪里去？ ##

### 数据中台从哪里来？ ###

### 数据中台到哪里去？ ###

数据中台和业务的关系，就是鱼和水的meta关系，谁也离不开谁