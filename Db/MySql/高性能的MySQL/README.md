# 高性能的MySQL #

## 第1章 MySQL架构与历史 ##

### 1.1 MySQL逻辑架构 ###

#### 1.1.1 连接管理与安全性 ####

每个客户端连接都会在服务器进程中拥有一个线程，这个连接的查询只会在这个单独的线程中执行，该线程只能轮流在某个CPU核心或者CPU中运行。服务器会负责缓存线程，因此不需要为每一个新建的连接创建或者销毁线程。

#### 1.1.2 优化与执行 ####

### 1.2 并发控制 ###

服务器层与存储引擎层

#### 1.2.1 读写锁 ####

共享锁（shared lock）和排他锁（exclusive lock），读锁（read lock）和写锁（write lock）

读锁是共享的，或者说是相互不阻塞的。

#### 1.2.2 锁粒度 ####

**表锁（table lock）**

**行级锁（row lock）**

### 1.3 事务 ###

事务就是一组原子性的SQL查询，或者说一个独立的工作单元。如果数据库引擎能够成功地对数据库应用该组查询的全部语句，那么就执行该组查询。

#### 1.3.1 隔离级别 ####

* READ UNCOMMITTED（未提交读）：事务中的修改，即使没有提交，对其他事务也都是可见的。（读取未提交的数据，脏读）。实际应用中很少使用
* READ COMMITTED（提交读）：大多数数据库系统的默认隔离级别都是READ COMMITTED。
* REPEATABLE READ（可重复读）：MySQL的默认事务隔离级别
* SERIALIZABLE（可串行化）：SERIALIZABLE会在读取的每一行数据上都加锁，可能导致大量的超时和锁争用的问题。

|隔离级别|脏读可能性|不可重复读可能性|幻读可能性|加锁读|
|--|--|--|--|--|
|READ UNCOMMITTED|Yes|Yes|Yes|No|
|READ COMMITTED|No|Yes|Yes|No|
|REPEATABLE READ|No|No|Yes|No|
|SERIALIZABLE|No|No|No|Yes|

#### 1.3.2 死锁 ####

#### 1.3.3 事务日志 ####

事务日志可以帮助提高事务的效率。使用事务日志，存储引擎在修改表的数据时只需要修改其内存拷贝，再把该修改行为记录到持久在硬盘上的事务日志中，而不用每次都将修改的数据本身持久到磁盘。事务日志采用的是追加的方式，因此写日志的操作是磁盘上小块区域内的顺序I/O，而不像随机I/O需要在磁盘的多个地方移动磁头，所以采用的事务日志的方式相对来说要快得多。事务日志持久化以后，内存中被修改的数据在后台可以慢慢地刷回到磁盘。

#### 1.3.4 MySQL中的事务 ####

MySQL提供了两种事务型的存储引擎：InnoDB和NDB Cluster。

**隐式和显式锁定**

InnoDB采用的是两阶段锁定协议。在事务执行过程中，随时都可以执行锁定，锁只有在执行COMMIT或者ROLLBACK的时候才会释放，并且所有的锁是在同一时刻被释放。

### 1.4 多版本并发控制 ###

MVCC是行级锁的一个变种。MVCC的实现，是通过保存素火炬在某个时间点的快照来实现的。

### 1.5 MySQL的存储引擎 ###

### 1.6 MySQL时间线 ###

### 1.7 MySQL的开发模式 ###

### 1.8 总结 ###

MySQL拥有分层的架构。上层是服务器层的服务和查询执行引擎，下层则是存储引擎。

## 第2章 MySQL基准测试 ##

2.1 为什么需要基准测试

2.2 基准测试的策略

2.3 基准测试方法

2.4 基准测试工具

2.5 基准测试安利

2.6 总结

## 第3章 服务器性能剖析 ##

最长碰到的三个性能相关的服务请求是：如何确认服务器是否达到了性能最佳的状态、找出某条语句为什么执行不够快，以及判断被用户描述成停顿“”、“堆积”或者“卡死”的某些间歇性疑难故障。

### 3.1 性能优化简介 ###

#### 3.1.1 通过性能剖析进行优化 ####



性能即响应时间

## 第4章 Schema与数据类型优化 ##

### 4.1 选择优化的数据类型 ###

更小的通常更好。

简单就好

尽量避免NULL

#### 4.1.1 整数类型 ####




## 第5章 创建高性能的索引 ##

索引（在MySQL中也叫做“键（key）”）是存储引擎用于快速找到记录的一种数据结构。这是索引的基本功能。

索引优化应该是对查询性能优化最有效的手段。索引能够轻易将查询性能提高两个数量级，“最优”的索引有时比一个“好的”索引性能要好两个数量级。创建一个真正“最优”的索引经常需要重写查询。

### 5.1 索引基础 ###

#### 5.1.1 索引的类型 ####

索引有很多种类型，可以为不同的场景提供更好的性能。在MySQL种，索引在存储引擎层而不是服务器层实现的。=>并没有统一的索引标准：不同存储引擎的索引的工作方式并不一样，也不是所有的存储引擎都支持所有类型的索引。即使多个存储引擎支持同一种类型的索引，其底层的实现也可能不同。

**B-Tree索引**

如果没有特别指明类型，那么多半是B-Tree索引，使用B-Tree数据结构来存储数据。

索引的优点

### 5.2 索引的优点 ###

索引可以让服务器快速定位到表的指定位置。但是这并不是索引的唯一作用，到目前为止可以看到，根据创建索引的数据结构不同，索引也有一些其他的附加作用。



### 5.3 高性能的索引策略 ###

### 5.4 索引案例学习 ###

### 5.5 维护索引和表 ###

### 5.6 总结 ###

## 第6章 查询性能优化 ##

## 第7章 MySQL高级特性 ##

## 第8章 优化服务器设置 ##

## 第9章 操作系统和硬件优化 ##

## 第10章 复制 ##