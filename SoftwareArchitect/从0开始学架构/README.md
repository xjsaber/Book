# 从0开始学架构 #

开篇词

## 开篇词 | 照着做，你也能成为架构师！ ##

**架构设计的关键思维是判断和取舍，程序设计的关键思维是逻辑和实现。**

这个专栏涵盖了我的整套架构设计方法论和架构实践，主要包括以下内容。

* **架构基础**：我会先介绍架构设计的本质、历史背景和目的，然后从复杂度来源以及架构设计的原则和流程来详细介绍架构基础。
* **高性能架构模式**：我会从存储高性能、计算高性能方面，介绍几种设计方案的典型特征和应用场景。
* **高可用架构模式**：我会介绍 CAP 原理、FMEA 分析方法，分析常见的高可用存储架构和高可用计算架构，并给出一些设计方法和技巧。
* **可扩展架构模式**：我会介绍可扩展模式及其基本思想，分析一些常见架构模式。
* **架构实战**：我会将理论和案例结合，帮助你落地前面提到的架构原则、架构流程和架构模式。

基础架构

## 01 | 架构到底是指什么？ ##

### 系统与子系统 ###

* 系统泛指由一群有关联的个体组成，根据某种规则运作，能完成个别元件不能单独完成的工作的群体。它的意思是“总体”“整体”或“联盟”。
	* 关联：系统是由一群有关联的个体组成的，没有关联的个体堆在一起不能成为一个系统。
	* 规则：系统内的个体需要按照指定的规则运作，而不是单个个体各自为政。规则规定了系统内个体分工和协作的方式。
	* 能力：系统能力与个体能力有本质的差别，系统能力不是个体能力之和，而是产生了新的能力。 
* 子系统也是由一群有关联的个体所组成的系统，多半会是更大系统中的一部分。其实子系统的定义和系统定义是一样的，只是观察的角度有差异，一个系统可能是另外一个更大系统的子系统。
	* 微信本身是一个系统，包含聊天、登录、支付、朋友圈等子系统。
	* 朋友圈这个系统又包括动态、评论、点赞等子系统。
	* 评论这个系统可能又包括防刷子系统、审核子系统、发布子系统、存储子系统。
	* 评论审核子系统不再包含业务意义上的子系统，而是包括各个模块或者组件，这些模块或者组件本身也是另外一个维度上的系统。例如，MySQL、Redis 等是存储系统，但不是业务子系统。

### 模块与组件 ###

* MySQL 模块主要负责存储数据，而 ElasticSearch 模块主要负责数据搜索。
* 我们有安全加密组件、有审核组件。
* App 的下载模块使用了第三方的组件。
 
模块和组件都是系统的组成部分，只是从不同的角度拆分系统而已。

从逻辑的角度来拆分系统后，得到的单元就是“模块”；从物理的角度来拆分系统后，得到的单元就是“组件”。划分模块的主要目的是职责分离；划分组件的主要目的是单元复用。其实，“组件”的英文 component 也可翻译成中文的“零件”一词，“零件”更容易理解一些，“零件”是一个物理的概念，并且具备“独立且可替换”的特点。

### 框架与架构 ###

## 02 | 架构设计的历史背景 ##

## 03 | 架构设计的目的 ##

## 04 | 复杂度来源：高性能 ##

架构设计的主要目的是为了解决软件系统复杂度带来的问题。深入分析复杂度的 6 个来源，先来聊聊**复杂度的来源之一高性能**。

软件系统中高性能带来的复杂度主要体现在两方面，一方面是**单台计算机内部为了高性能带来的复杂度**；另一方面是**多台计算机集群为了高性能带来的复杂度**。

### 单机复杂度 ###

计算机内部复杂度最关键的地方就是操作系统。

操作系统和性能最相关的就是**进程**和**线程**。

1. 低效：最早的计算机其实是没有操作系统的，只有输入、计算和输出功能，用户输入一个指令，计算机完成操作，大部分时候计算机都在等待用户输入指令，这样的处理性能很显然是很低效的，因为人的输入速度是远远比不上计算机的运算速度的。
2. 单任务
3. 


### 集群的复杂度 ###

通过大量机器来提升性能，并不仅仅是增加机器这么简单，让多台机器配合起来达到高性能的目的，是一个复杂的任务，我针对常见的几种方式简单分析一下。

**1. 任务分配**

任务分配的意思是指每台机器都可以处理完整的业务任务，不同的任务分配到不同的机器上执行。

1 台服务器演变为 2 台服务器后，架构上明显要复杂多了，主要体现在：

1. 需要增加一个任务分配器，需要综合考虑性能、成本、可维护性、可用性
	1. 硬件网络设备（F5，交换机）
	2. 软件网络设备（LVS）
	3. 负载均衡软件（Nginx、HAProxy）
	4. 自己开发的系统
2. 任务分配器和真正的业务服务器之间有连接和交互，需要需要选择合适的连接方式，并且对连接进行管理。
	1. 连接建立
	2. 连接检查
	3. 连接中断如何处理	
3. 任务分配器需要增加分配算法。
	1. 轮询算法
	2. 权重算法
	3. 负载进行分配，如果按照服务器的负载进行分配，则业务服务器还要能够上报自己的状态给任务分配器。

因为随着性能的增加，任务分配器本身又会成为性能瓶颈。

1. 任务分配器从 1 台变成了多台（对应图中的任务分配器 1 到任务分配器 M），这个变化带来的复杂度就是需要将不同的用户分配到不同的任务分配器上
	1.  DNS 轮询
	2.  智能 DNS
	3.  CDN（Content Delivery Network，内容分发网络）
	4.  GSLB 设备（Global Server Load Balance，全局负载均衡）
2. 任务分配器和业务服务器的连接从简单的“1 对多”（1 台任务分配器连接多台业务服务器）变成了“多对多”（多台任务分配器连接多台业务服务器）的网状结构。
3. 机器数量增加，状态管理、故障处理复杂度也大大增加。

**2. 任务分解**



### 小结 ###

软件系统中高性能带来的复杂度主要体现在两方面：

1. 单台计算机内部为了高性能带来的复杂度，
2. 多态计算机集群为了高性能带来的复杂度。

这就是今天的全部内容，留一道思考题给你吧。你所在的业务体系中，高性能的系统采用的是哪种方式？目前是否有改进和提升的空间？

## 05 | 复杂度来源：高可用 ##

这个定义的关键在于“**无中断**”

系统的高可用方案五花八门，但万变不离其宗，本质上都是通过“**冗余**”来实现高可用。

高可用的“冗余”解决方案，单纯从形式上来看，和之前讲的高性能是一样的，都是通过增加更多机器来达到目的，但其实本质上是有根本区别的：**高性能增加机器目的在于“扩展”处理性能；高可用增加机器目的在于“冗余”处理单元**。

### 计算高可用 ###

* 需要增加一个任务分配器，选择合适的任务分配器也是一件复杂的事情，需要综合考虑性能、成本、可维护性、可用性等各方面因素。
* 任务分配器和真正的业务服务器之间有连接和交互，需要选择合适的连接方式，并且对连接进行管理。例如，连接建立、连接检测、连接中断后如何处理等。
* 任务分配器需要增加分配算法。例如，常见的双机算法有主备、主主，主备方案又可以细分为冷备、温备、热备。

### 存储高可用 ###

### 高可用状态决策 ###

无论是计算高可用还是存储高可用，其基础都是“**状态决策**”，即系统需要能够判断当前的状态是正常还是异常，如果出现了异常就要采取行动来保证高可用。如果状态决策本身都是有错误或者有偏差的，那么后续的任何行动和处理无论多么完美也都没有意义和价值。但在具体实践的过程中，恰好存在一个本质的矛盾：**通过冗余来实现的高可用系统，状态决策本质上就不可能做到完全正确**。

**1. 独裁式**

**2. 协商式**

**3. 民主式**

### 小结 ###

复杂度来源之一的高可用，分析了计算高可用和存储高可用两个场景，给出了集中高可用状态决策方式。

这就是今天的全部内容，留一道思考题给你吧。高性能和高可用是很多系统的核心复杂度，你认为哪个会更复杂一些？理由是什么？

## 06 | 复杂度来源：可扩展性 ##

## 13 | 架构设计流程：详细方案设计 ##

高性能架构模式

高可用架构模式

可扩展架构模式

架构实战

特别放送


结束语

结课测试

