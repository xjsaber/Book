# 分布式协议与算法实战 #

## 开篇词 ##

## 01 | 拜占庭将军问题：有叛徒的情况下，如何才能达成共识 ##

如果叛将人数为 m，将军人数不能少于 3m + 1 ，那么拜占庭将军问题就能解决了。

### 内容小结 ###

计算机分布式系统中，最常用的是非拜占庭容错算法，即故障容错算法（Crash Fault Tolerance，CFT）。CFT 解决的是分布式的系统中存在故障，但不存在恶意节点的场景下的共识问题。 常见的算法有 Paxos 算法、Raft 算法、ZAB 协议。

### 课堂思考 ###

文中我提了两类容错算法，分别是拜占庭容错算法和非拜占庭容错算法，那么在常见的分布式软件系统中，哪些场景必须要使用拜占庭容错算法呢？哪些场景使用非拜占庭容错算法就可以了呢？

## 02 | CAP理论：分布式系统的PH试纸，用它来测酸碱度 ##

### CAP三指标 ###

* 一致性（Consistency）：一致性强调的不是数据完整，而是各节点间的数据一致。
* 可用性（Availability）
* 分区容错性（Partition Tolerance）

### 内容小结 ###

* CA模型，在分布式系统中不存在。因为舍弃 P，意味着舍弃分布式系统，就比如单机版关系型数据库 MySQL，如果 MySQL 要考虑主备或集群部署时，它必须考虑 P。
* CP 模型，采用 CP 模型的分布式系统，一旦因为消息丢失、延迟过高发生了网络分区，就影响用户的体验和业务的可用性。因为为了防止数据不一致，集群将拒绝新数据的写入，典型的应用是 ZooKeeper，Etcd 和 HBase。
* AP 模型，采用 AP 模型的分布式系统，实现了服务的高可用。用户访问系统的时候，都能得到响应数据，不会出现响应错误，但当出现分区故障时，相同的读操作，访问不同的节点，得到响应数据可能不一样。典型应用就比如 Cassandra 和 DynamoDB。

在当前分布式系统开发中，延迟是非常重要的一个指标

### 课堂思考 ###

CP 模型的 KV 存储和 AP 模型的 KV 存储，分别适合怎样的业务场景呢

CP模型的KV存储，适合各个用户访问节点的数据是一样的，适合对数据比较敏感的场景，类似银行

AP模型的KV存储，适合保证各个用户可以直接访问的节点，适合IM等环境