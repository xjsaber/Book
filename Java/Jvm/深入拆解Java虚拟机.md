# 深入拆解Java虚拟机 #

## 01 | Java代码是怎么运行的？ ##

## 02 | Java的基本类型 ##

Java，8个基本类型

### Java虚拟机的boolean类型 ###

### Java的基本类型 ###

|类型|值域|默认值|虚拟机内部符号|
|--|--|--|--|
|boolean|{false,true}|false|Z|
|byte|[-128,127]|0|B|
|short|[-32768,32767]|0|S|
|char|[0,65535]|'\u0000'|C|
|int|[-2^31,2^31-1]|0|I|
|long|{-2^64,2^64-1}|0L|J|
|float|~[3.4E38,3.4E38]|+0.0F|F|
|double|~[1.8E308,1.8E308]|+0.0D|D|

基本类型中，boolean和char是唯二的无符号类型。

### Java的基本类型的大小 ###

Java虚拟机每调用一个Java方法，便会创建一个栈帧。

这个栈帧有两个主要部分，分别是局部变量区，以及字节码的操作数栈。

在Java虚拟机规范中，局部变量区等价于一个数组，并且用正整数来索引。除了long、double值需要两个数组单元来存储之外，其他基本类型以及引用类型的值均占用一个数组单元。

### 总结与实践 ###

boolean类型在Java虚拟机中被映射为整数类型。“true”被映射为1，而“false”被映射为0。Java代码中的逻辑运算以及条件跳转，都是用整数相关的字节码来实现的。

除long和double外，其他基本类型与引用类型在解释执行在方法栈中占用的大小是一致的，但它们在堆中占用的大小却不同。在将boolean、byte、char以及short的值存入字段或者数组单元时，Java虚拟机会进行掩码操作。在读取时，Java虚拟机则会将其扩展为int类型。

## 03 | Java虚拟机是如何加载Java类的 ##

加载、链接以及初始化

Java将其细分为四种：类、接口、数组类和泛型参数。

### 加载 ###

加载：是指查找字节流，并且据此创建类的过程。根据ch2，对于数组类来说，它并没有对应的字节流，而是由Java虚拟机直接生成的。对于其他类来说，Java虚拟机则需要借助类加载器来完成查找字节流的过程。

启动类加载器，另外两个重要的类加载器是扩展类加载器（extension class loader）和应用类加载器（application class loader）

扩展类加载器的父类是启动类加载器。它负责加载相对次要、但又通用的类

应用类加载器的父类是扩展类加载器。

Java9引入了模块系统，扩展类加载器被改名为平台类加载器（platform class loader）。Java SE

### 链接 ###

链接，是指将创建成的类合并至Java虚拟机中，使之能够执行的过程。分为验证、准备以及解析三个阶段。

准备阶段的目的，则是为被加载类的静态字段分配内存。Java代码中对静态字段的具体初始化，则会在稍后的初始化阶段中进行。

除了分配内存，部分Java虚拟机还会在此构造其他跟类层次相关的数据结构，比如说用来实现虚方法的动态绑定的方法表。

解析阶段的目的，正是将这些符号引用解析称为实际引用。如果符号引用指向一个未被加载的类，或者未被加载类的字段或方法，那么解析将触发这个类的加载（但未必触发这个类的链接以及初始化）

Java虚拟机规范并没有要求在链接过程中完成解析。仅规定了：如果某些字节码使用了符号引用，那么在执行这些字节码之前，需要对这些符号引用的解析。

### 初始化 ###

在Java代码中，如果要初始化一个静态字段，可以在声明时直接赋值，也可以在静态代码块中对其赋值。

如果直接赋值的静态字段被final所修饰，并且它的类型是基本类型或字符串时，那么该字段便会被Java编译器标记成常量值（ConstantValue），其初始化直接由Java虚拟机完成。除此之外的直接赋值操作，以及所有静态代码块中的代码，则会被Java编译器置于同一方法中，并把它命名为<clinit>。

类加载的最后一步是初始化，便是为标记为常量值的字段赋值，以及执行<clinit>方法的过程。Java虚拟机会通过加锁来确保类的<clinit>方法仅被执行一次。

只有当初始化完成之后，类才正式成为可执行的状态。


### 总结与实践 ###



## 04 | JVM是如何执行方法调用的（上） ##

## 05 | JVM是如何执行方法调用的（下） ##



