# Java性能权威指南 #

第1章 导论

第2章 性能测试方法

## 第3章 Java性能调优工具箱 ##

### 3.1 操作系统的工具和分析 ###

#### 3.1.1 CPU使用率 ####

通常CPU使用率可以分为两类：用户态时间和系统态时间（Windows上被称作privileged time）。用户态时间是CPU执行应用代码所占时间的百分比，而系统态时间则是CPU执行内核代码所占时间的百分比。系统态时间与应用相关，比如应用执行I/O操作，系统就会执行内核代码从磁盘读取文件，或者讲缓冲数据发送到网路。

性能调优的目的是，在尽可能短的时间内让CPU使用率尽可能地高。

vmstat 1

CPU空闲可能有以下原因。

* 应用被同步原语阻塞，直至锁释放才能继续执行。
* 用在等待某些东西，例如数据库调用所返回的响应。
* 应用的确是无所事事。

**1. Java和单CPU的使用率**

**2. Java和多CPU的使用率**

#### 3.1.2 CPU运行队列 ####

Windows和Unix系统都可以监控可运行（意味着没有被I/O阻塞、休眠等）的线程数。

**快速小结**

1. 检查应用性能时，首先应该审查CPU时间。
2. 优化代码的目的是提升而不是降低（更短时间段内的）CPU使用率。
3. 在试图深入优化应用前，应该先弄清楚为何CPU使用率低

#### 3.1.3 磁盘使用率 ####

监控磁盘使用率有两个目的。

1. 目的与应用本身有关：如果应用正在做大量的磁盘I/O操作，那I/O就很容易成为瓶颈。

**快速小结**

1. 对于所有应用来说，监控磁盘使用率非常重要。即便不直接写磁盘的应用，系统交换仍然会影响它们的性能。
2. 写入磁盘的应用遇到瓶颈，是因为写入数据的效率不高（吞吐量太低），或者是因为写入太多数据（吞吐量太高）。

#### 3.1.4 网络使用率 ####

Unix系统监控网络的基本工具是netstat，Windows上可以在脚本中使用typeperf，监控网络使用率。

nicstat，显示每个网络接口的流量概要。

**快速小结**

1. 对基于网络的应用来说，务必要监控网络以确保它不是瓶颈。
2. 往网络写数据的应用遇到瓶颈，可能是因为写数据的效率太低（吞吐量太低），也可能是因为写入了太多的数据（吞吐量太高）。

### 3.2 Java监控工具 ###

* jcmd
* jconsole
* jhat
* jmap
* jinfo
* jstack
* jstat
* jvisualvm

#### 3.2.1 基本的VM信息 ####

