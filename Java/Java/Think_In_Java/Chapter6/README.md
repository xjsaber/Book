# 第6章 访问权限控制 #

访问控制（或隐藏具体实现）与“最初的实现并不恰当”有关。

访问权限控制的等级，从最大权限到最小权限依次为：public、protected、包访问权限（没有关键字）和private。

## 6.1 包：库单元 ##

导入单个的类

	import java.util.ArrayList;

导入其中的所有的类，需要使用“*”

	import java.util.*;

当编写一个Java源代码文件时，此文件通常被称为编译单元（有时也被称为转译单元）。每个编译单元都必须有一个后缀名.java，而在编译单元内则可以有一个public类，该类的名称必须与文件的名称相同（包括大小写，但不包括文件的后缀名.java）。每个编译单元只能有一个public类，否则编译器就不会接受。如果在该编译单元之中还有额外的类的话，那么在包之外的世界是无法看见这些类的，这是因为它们不是public类，而且它们主要用来为主public类提供支持。

### 6.1.1 代码组织 ###

当编译一个.java文件时，在.java文件中的每个类都会有一个输出文件，而该输出文件的名称与.java文件中每个类的名称相同，只是多了一个后缀名.class。因此，在编译少量.java文件之后，会得到大量的.class文件。如果用编译型语言编写过程序，那么对于编译器产生一个中间文件（通常是一个obj文件），然后再与通过链接器（用以创建一个可执行文件）或类库产生器（librarian，用以创建一个类库）产生的其他同类文件捆绑在一起的情况。

Java可运行程序是一组可以打包并压缩为一个Java文档文件（JAR，使用Java的jar文档生成器）的.class文件。Java解释器负责这些文件的查找、装载和解释。

类库实际上是一组类文件。其中每个文件都有一个public类，以及任意数量的非public类。因此每个文件都有一个构件。如果希望这些构件（每一个都有它们自己的独立的.java和.class文件）从属于同一个群组，就可以使用关键字package。

### 6.1.2 创建独一无二的包名 ###

将特定包的所有.class文件都置于一个目录下，利用操作系统的层次化的文件结构来解决

将所有的文件收入一个子目录还可以解决另外两个问题：怎样创建独一无二的名称以及怎样查找有可能隐藏于目录结构中某处的类。

### 6.1.3 定制工具类 ###

Print类

### 6.1.4 用inport改变行为 ###

调试功能在开发过程中是开启的，而在发布的产品中是禁用的。可以通过修改被导入的package的方法来实现这一目的，修改的方法是将你的程序中用到的代码从调试版改为发布版。

//TODO 练习3

### 6.1.5 对使用包的忠告 ###

最初使用关键字package，遵守“包的名称对应目录路径”的规则，否则将会收到许多出乎意料的运行时信息，告知无法找到特定的类，哪怕是这个类就位于同一个目录之中。

## 6.2 Java访问权限修饰符 ##

public、protected和private

如果不提供任何访问权限修饰词，则意味着它是“包访问权限”。

### 6.2.1 包访问权限 ###

默认访问权限没有任何关键字，但通常是指包访问权限（有时也可以表示成为**friendly**）。由于一个编译单元（即一个文件），只能隶属于一个包，所以经由包访问权限，处于同一个编译单元中的所有类彼此之间都是自动可访问的。

1. 使该成员成为piblic。
2. 通过不加访问权限修饰词并将其他类放置于同一个包内的方式给成员赋予包访问权。于是包内的其他类也就可以访问该成员。
3. 继承而来的类既可以访问public成员也可以访问protected成员（但访问private成员却不行）。只有在两个类都处于同一个包内时，它才可以访问包访问权限的成员。但现在不必担心继承和protected。
4. 提供访问器（accessor）和变异器（mutator）方法（也称作get/set），以读取和改变数值。

### 6.2.2 public：接口访问权限 ###

使用关键字public，就意味着public之后紧跟着的成员声明自己对每个人都是可用的，尤其是使用类库的客户程序员更是如此。

#### 默认包 ####

通常会认为Pie和f()享有包访问权限，因而是不可以为Cake所用的。它们的确有包访问权限。

### 6.2.3 private：你无法访问 ###

关键字private的意思是，除了包含该成员的类之外，其他任何类都无法访问这个成员。由于处于同一个包内的其他类是不可以访问private成员的。

private用武之地的示例：可能想控制如何创建对象，并阻止别人直接访问某个特定的构造器（或全部构造器）。

默认的包访问权限通常已经提供了充足的隐藏措施。

除非公开底层实现细目（此种情况很少见），否则旧应该将所有的域指定为private。然而，不能因为在此类中某个对象的引用是private，就认为其他的对象无法拥有该对象的public引用。

### 6.2.4 protected：继承访问权限 ###

关键字protected处理的是继承的概念，通过继承可以利用一个现有类，我们称为基类。

关键字protected处理的是继承的概念，通过继承可以利用一个现有类（基类），然后将新成员添加到该现有类中而不必碰该现有类。

//TODO 4-6

## 6.3 接口的实现 ##

访问权限的控制常被称为是*具体实现的隐藏*。把数据和方法包装进类中，以及具体实现的隐藏，常共同被称作是*封装*。其结果是一个同时带有特征和行为的数据类型。

第一个原因是要设定客户端程序员可以使用和不可以使用的界限。可以在结构中建立自己的内部机制，而不必担心客户端程序员会偶然地将内部机制当做是他们可以使用的接口的一部分。

第二个原因，即将接口和具体实现进行分离。

javadoc所提供的注释文档功能降低了程序代码的可读性对客户端程序员的重要性。将接口展现给某个类的使用者实际上是类浏览器的任务。

## 6.4 类的访问权限 ##

如果某个类可以为某个客户端所用

1. 每个编译单元（文件）都只能有一个public类。这表示，每个编译单元都有单一的公共接口，用public类来表现。该接口可以按要求包含众多的支持包访问权限的类。
2. public类的名称必须完全与含有该编译单元的文件名相匹配，包括大小写。
3. 编译单元内不带public类也是可能的。

//TODO 7

在创建一个包访问权限的类时，仍旧是在该类的域声明为private时才有意义-尽可能地总是将域指定为私有的，但是通常来说，将与类(包访问权限)相同的访问权限赋予方法也是很合理的。既然一个有包访问权限的类通常只能被用于包内，那么如果对你有强制要求，在此种情况下，编译器会告诉你，只需要将这样的类的方法设定为public就可以了。

类既不可以是private的，也不可以是protected的。所以对类的访问权限，仅有两个选择：包访问权限或public。如果不希望其他任何人对该类拥有访问权限，可以把所有的构造器都指定为private，从而阻止任何人创建该类的对象，但是有一个例外，就是你在该类的static成员成员可以创建。

//TODO 8-9

## 6.5 总结 ##

对于Java，关键字package、包的命名模式和关键字import，可以使你对名称进行完全的控制，因此名称冲突的问题是很容易避免的。

控制对成员的访问权限有两个原因。第一是为了使用户不要碰触那些他们不该接触的部分，这些部分对于类用户的操作是必要的，但是它并不属于客户端程序员所需接口的一部分。

因此，将方法和域指定成private，对客户端程序员而言是一种服务。因为这样他们可以很清楚地看到什么对他们重要，什么是他们可以忽略的。

第二个原因，也是最重要的原因，是为了让类库设计者可以更改类的内部工作方式，而必须担心这样对客户端程序员产生重大的影响。当具备了改变底层实施细节的能力时，不仅可以随意地改善设计，还能随意地翻错误，同时也就有了犯错的可能性。

注意，访问权限控制专注于类库创建者和该类库的外部使用者之间的关系，这种关系也是一种通信方式。